{"code":"import * as fs from 'fs';\r\nconst path = require('path');\r\nlet rootPath = __dirname;\r\nlet texturePath = path.resolve(rootPath, 'assets/resources/texture');\r\nlet spriteConfigPath = path.resolve(rootPath, 'config/sprite.config.json');\r\nlet excludes = [];\r\nconst packSubKeys = {};\r\nfunction setSubKey() {\r\n    const dirs = fs.readdirSync(texturePath);\r\n    dirs.forEach((dir) => {\r\n        if (excludes.includes(dir) || !fs.existsSync(path.resolve(texturePath, `${dir}/auto-atlas.pac`)))\r\n            return;\r\n        const stat = fs.lstatSync(path.resolve(texturePath, dir));\r\n        if (stat.isDirectory()) {\r\n            packSubKeys[dir] = {};\r\n            const files = fs.readdirSync(path.resolve(texturePath, dir));\r\n            const images = [];\r\n            files.forEach((file) => {\r\n                if (file.indexOf('.meta') < 0 && file.indexOf('.pac') < 0 && file.indexOf('.DS') < 0) {\r\n                    if (/\\s/.test(file))\r\n                        throw new Error(`[setSubKey]the file name can not contain space: ${dir}/${file}`);\r\n                    file = file.split('.')[0];\r\n                    images.push(file);\r\n                }\r\n            });\r\n            packSubKeys[dir] = images.join(',');\r\n        }\r\n    });\r\n}\r\nfunction createSpriteConfig(options = {}) {\r\n    if (options.rootPath)\r\n        rootPath = options.rootPath;\r\n    if (options.texturePath)\r\n        texturePath = options.texturePath;\r\n    if (options.spriteConfigPath)\r\n        spriteConfigPath = options.spriteConfigPath;\r\n    if (options.excludes)\r\n        excludes = options.excludes;\r\n    setSubKey();\r\n    const spriteConfig = {\r\n        engine: 'egret',\r\n        size: {\r\n            width: 2048,\r\n            height: 2048,\r\n        },\r\n        webp: true,\r\n        quality: [0.8, 0.9],\r\n        spriteConfig: {},\r\n    };\r\n    Object.keys(packSubKeys).forEach((name) => {\r\n        const group = (spriteConfig.spriteConfig[name] = {});\r\n        group.keys = packSubKeys[name].split(',');\r\n    });\r\n    fs.writeFileSync(spriteConfigPath, JSON.stringify(spriteConfig, null, 2));\r\n    console.log('sprite.config.json updated');\r\n}\r\nmodule.exports = {\r\n    createSpriteConfig\r\n};\r\n","references":[],"dts":{"name":"/Users/peihongchen/Project/remote-atlas-util/node_modules/.cache/rollup-plugin-typescript2/placeholder/tool.d.ts","writeByteOrderMark":false,"text":"export {};\r\n"}}
